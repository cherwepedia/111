---
layout: default
---
<article class="article">
  <header class="article-header">
    <h1 class="article-title">{{ page.title }}</h1>
  </header>

  <div class="article-container">
    {% if page.infobox %}
    <aside class="infobox">
      {% if page.infobox.image %}
      <div class="infobox-image-wrapper">
        <img src="{{ page.infobox.image }}" alt="{{ page.title }}" class="infobox-image" data-lightbox>
        <div class="infobox-image-title">{{ page.title }}</div>
      </div>
      {% endif %}

      {% if page.infobox.data %}
      <table class="infobox-table">
        {% for item in page.infobox.data %}
        <tr>
          <th>{{ item.label }}</th>
          <td>{{ item.value }}</td>
        </tr>
        {% endfor %}
      </table>
      {% endif %}
    </aside>
    {% endif %}

    <div class="article-body">
      {% if page.intro %}
      <p class="article-intro">{{ page.intro | markdownify }}</p>
      {% endif %}

      <details class="toc" open>
        <summary class="toc-toggle">Содержание</summary>
        <nav class="toc-nav" id="toc-nav"></nav>
      </details>

      <div class="article-content" id="article-content">
        {{ content }}
      </div>
    </div>
  </div>

  {% if page.gallery %}
  <section class="article-gallery">
    <h2>Галерея</h2>
    <div class="gallery-grid">
      {% for img in page.gallery %}
      <figure class="gallery-item">
        <img src="{{ img.src }}" alt="{{ img.caption }}" data-lightbox>
        {% if img.caption %}
        <figcaption>{{ img.caption }}</figcaption>
        {% endif %}
      </figure>
      {% endfor %}
    </div>
  </section>
  {% endif %}

  <footer class="article-footer">
    <div class="article-categories">
      {% for cat in page.categories %}
      {% assign category_data = site.data.categories | where: "id", cat | first %}
      <a href="{{ '/categories/' | relative_url }}#{{ cat }}" class="category-tag">
        {{ category_data.name | default: cat }}
      </a>
      {% endfor %}
    </div>
  </footer>
</article>

<style>
/* === КЛЮЧЕВОЙ ФИКС === */
/* убираем flex, чтобы float работал нормально */
.article-container {
  display: block;
}

/* инфобокс как в вики */
.infobox {
  float: right;
  width: 300px;
  margin: 0 0 1em 1.5em;
}

/* после низа инфобокса текст сам занимает всю ширину */
.article-body {
  overflow: visible;
}

/* карточки / картинки внутри текста */
.article-content .card,
.article-content figure {
  float: right;
  margin: 0 0 1em 1em;
  max-width: 45%;
}

/* очистка после карточек */
.clear-after-float {
  clear: both;
}
</style>

<script>
/* === ПРАВИЛЬНОЕ ПОВЕДЕНИЕ ПОСЛЕ КАРТОЧЕК ===
   1. карточка внутри абзаца → обтекание
   2. следующий блок начинается ПОД карточкой
*/
(function () {
  const content = document.getElementById('article-content');
  if (!content) return;

  const blocks = Array.from(content.children);
  blocks.forEach((block, i) => {
    if (
      block.tagName === 'P' &&
      block.querySelector('.card, figure')
    ) {
      const next = blocks[i + 1];
      if (next) next.classList.add('clear-after-float');
    }
  });
})();
</script>

<script>
/* === TOC === */
(function() {
  const content = document.getElementById('article-content');
  const tocNav = document.getElementById('toc-nav');
  if (!content || !tocNav) return;

  const headings = content.querySelectorAll('h2, h3');
  if (!headings.length) {
    document.querySelector('.toc')?.remove();
    return;
  }

  const ul = document.createElement('ul');
  let currentH2Li = null;

  headings.forEach((h, i) => {
    if (!h.id) h.id = 'section-' + i;

    const li = document.createElement('li');
    const a = document.createElement('a');
    a.href = '#' + h.id;
    a.textContent = h.textContent;
    li.appendChild(a);

    if (h.tagName === 'H2') {
      currentH2Li = li;
      ul.appendChild(li);
    } else if (h.tagName === 'H3' && currentH2Li) {
      let sub = currentH2Li.querySelector('ul');
      if (!sub) {
        sub = document.createElement('ul');
        currentH2Li.appendChild(sub);
      }
      sub.appendChild(li);
    }
  });

  tocNav.appendChild(ul);
})();
</script>
