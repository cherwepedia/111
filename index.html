---
layout: default
title: Главная
---

<div class="container">
  <!-- Hero Section -->
  <section class="home-hero">
    <h1 class="home-title">Червепедия — Энциклопедия Черветреда</h1>
    <p class="home-subtitle">
      Добро пожаловать в Червепедию — самую полную энциклопедию о мире Черветреда.
      Здесь собраны статьи о людях, событиях, истоках и политике этого удивительного мира.
    </p>

    {% include search.html %}

    <div class="home-actions">
      <button class="btn nav-random" id="random-btn">
        <span>Случайная статья</span>
      </button>
      <a href="{{ '/categories/' | relative_url }}" class="btn">
        <span>Все категории</span>
      </a>
    </div>
  </section>

  <!-- Favorites Carousel / Популярные статьи -->
  {% assign favorites = site.posts | where: "favorites", true %}
  {% if favorites.size > 0 %}
  <section class="home-section">
    <header class="section-header">
      <h2 class="section-title">Популярные статьи</h2>
    </header>

    <div class="favorites-carousel">
      <button class="carousel-prev" aria-label="Предыдущая статья">‹</button>
      <button class="carousel-next" aria-label="Следующая статья">›</button>

      <div class="favorites-track">
        <!-- Первая копия карточек -->
        {% for post in favorites limit: 10 %}
        <a href="{{ post.url | relative_url }}" class="favorite-card">
          {% if post.infobox.image %}
          <img 
            src="{{ post.infobox.image | relative_url }}" 
            alt="{{ post.title | escape }}" 
            class="favorite-image" 
            loading="lazy">
          {% else %}
          <div class="favorite-image" style="background:#f0f0f0;"></div>
          {% endif %}
          <div class="favorite-content">
            <h3 class="favorite-title">{{ post.title | escape }}</h3>
            <p class="favorite-excerpt">
              {{ post.intro | default: post.excerpt | truncatewords: 25 | strip_html }}
            </p>
          </div>
        </a>
        {% endfor %}

        <!-- Вторая копия — обязательна для бесшовной бесконечной прокрутки -->
        {% for post in favorites limit: 10 %}
        <a href="{{ post.url | relative_url }}" class="favorite-card">
          {% if post.infobox.image %}
          <img 
            src="{{ post.infobox.image | relative_url }}" 
            alt="{{ post.title | escape }}" 
            class="favorite-image" 
            loading="lazy">
          {% else %}
          <div class="favorite-image" style="background:#f0f0f0;"></div>
          {% endif %}
          <div class="favorite-content">
            <h3 class="favorite-title">{{ post.title | escape }}</h3>
            <p class="favorite-excerpt">
              {{ post.intro | default: post.excerpt | truncatewords: 25 | strip_html }}
            </p>
          </div>
        </a>
        {% endfor %}
      </div>
    </div>

    <!-- Стили карусели -->
    <style>
      .favorites-carousel {
        position: relative;
        overflow: hidden;
        margin: 2.5rem 0;
        padding: 0 1rem;
      }

      .favorites-track {
        display: flex;
        gap: 1.5rem;
        width: max-content;
        animation: infiniteScroll 80s linear infinite;
        will-change: transform;
        scroll-snap-type: x mandatory;
        -webkit-overflow-scrolling: touch;
      }

      @keyframes infiniteScroll {
        0%   { transform: translateX(0); }
        100% { transform: translateX(-50%); }
      }

      .favorites-carousel:hover .favorites-track,
      .favorites-carousel.dragging .favorites-track {
        animation-play-state: paused;
      }

      /* Стрелки */
      .carousel-prev,
      .carousel-next {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 52px;
        height: 52px;
        background: rgba(0,0,0,0.55);
        color: white;
        font-size: 32px;
        font-weight: bold;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        z-index: 10;
        opacity: 0;
        transition: opacity 0.2s ease, background 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .favorites-carousel:hover .carousel-prev,
      .favorites-carousel:hover .carousel-next {
        opacity: 0.9;
      }

      .carousel-prev:hover,
      .carousel-next:hover {
        background: rgba(0,0,0,0.85);
        opacity: 1;
      }

      .carousel-prev { left: 16px; }
      .carousel-next { right: 16px; }

      @media (max-width: 768px) {
        .carousel-prev,
        .carousel-next {
          opacity: 0.75;
          width: 44px;
          height: 44px;
          font-size: 26px;
        }
        .carousel-prev { left: 10px; }
        .carousel-next { right: 10px; }
      }

      .favorite-card {
        flex: 0 0 300px;
        scroll-snap-align: start;
        background: white;
        border: 1px solid #e0e0e0;
        text-decoration: none;
        color: #1a1a1a;
        transition: border-color 0.2s;
      }

      .favorite-card:hover {
        border-color: #2d2d2d;
      }

      .favorite-image {
        width: 100%;
        height: 180px;
        object-fit: cover;
      }
    </style>
  </section>
  {% endif %}

  <!-- Последние статьи -->
  <section class="home-section">
    <header class="section-header">
      <h2 class="section-title">Последние статьи</h2>
      <a href="{{ '/categories/' | relative_url }}" class="section-link">Все статьи →</a>
    </header>

    <div class="latest-list">
      {% for post in site.posts limit: 5 %}
      <a href="{{ post.url | relative_url }}" class="latest-item">
        {% if post.infobox.image %}
        <img
          src="{{ post.infobox.image | relative_url }}"
          alt="{{ post.title | escape }}"
          class="latest-image">
        {% endif %}

        <div class="latest-content">
          <h3 class="latest-title">{{ post.title | escape }}</h3>

          <p class="latest-excerpt">
            {{ post.intro | default: post.excerpt | truncatewords: 35 | strip_html }}
          </p>

          <div class="latest-meta">
            {% assign cat = post.categories | first %}
            {% assign category_data = site.data.categories | where: "id", cat | first %}
            {{ category_data.name | default: cat }}
          </div>
        </div>
      </a>
      {% endfor %}
    </div>
  </section>
</div>

<!-- Search Data -->
<script type="application/json" id="search-data">
[
  {% for post in site.posts %}
  {
    "title": {{ post.title | jsonify }},
    "url": {{ post.url | relative_url | jsonify }},
    "intro": {{ post.intro | default: "" | strip_newlines | jsonify }},
    "content": {{ post.content | strip_html | truncate: 500 | strip_newlines | jsonify }},
    "image": {{ post.infobox.image | default: "" | relative_url | jsonify }},
    "categories": {{ post.categories | jsonify }}
  }{% unless forloop.last %},{% endunless %}
  {% endfor %}
]
</script>

<!-- JavaScript для кликабельных стрелок -->
<script>
document.addEventListener('DOMContentLoaded', function () {
  const carousel = document.querySelector('.favorites-carousel');
  if (!carousel) return;

  const track = carousel.querySelector('.favorites-track');
  const prev = carousel.querySelector('.carousel-prev');
  const next = carousel.querySelector('.carousel-next');

  if (!track || !prev || !next) return;

  function scrollBy(amount) {
    track.style.animationPlayState = 'paused';
    track.scrollBy({ left: amount, behavior: 'smooth' });

    setTimeout(() => {
      track.style.animationPlayState = 'running';
    }, 1400); // время чуть больше, чем длительность smooth
  }

  prev.addEventListener('click', () => scrollBy(-track.clientWidth));
  next.addEventListener('click', () => scrollBy( track.clientWidth));
});
</script>
